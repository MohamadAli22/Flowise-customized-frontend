<!DOCTYPE html>
<html lang="en">

<head>
  <title>Evolved AI Chatbot</title>
  <link rel="icon" href="favicon.ico" />
  <!-- Meta Tags-->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="title" content="Evolved AI Chatbot" />
  <meta name="description" content="Chatbot Description ..." />
  <meta name="keywords" content="react, material-ui, workflow automation, llm, artificial-intelligence" />
  <meta name="author" content="Evolved AI" />
  <!-- Open Graph / Facebook -->
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://evolved.ai/" />
  <meta property="og:site_name" content="https://www.evolved.ai/" />
  <meta property="og:title" content="Evolved AI Chatbot" />
  <meta property="og:description" content="Chatbot Description ..." />
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://twitter.com/EvolvedAI" />
  <meta property="twitter:title" content="Evolved AI Chatbot" />
  <meta property="twitter:description" content="Chatbot Description ..." />
  <meta name="twitter:creator" content="@EvolvedAI" />
</head>

<body>
  <flowise-fullchatbot></flowise-fullchatbot>
  <script>
    // To get a specific parameter by name
    function getUrlParam(param) {
      let urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }
    // to fetch data
    const fetchUrl = async url => {
      const response = await fetch(url)
        .catch(error => {
          console.error('Error:', error); // Handle any errors
        });
      return response.json();
    };

    //get theme from url
    theme_color = getUrlParam('theme') || "0d1e70"
    theme_color = '#'+theme_color
    //get chatId from url
    chatId = getUrlParam('chatid') || "a0dc8fd4-ca7a-40dd-aeac-9c33371311d0"

    // const
    const BASE_URL = "https://evolved-ai-flowise-chatbot.onrender.com"

    // config
    config = {}

    // get chatflow config
    configUrl = BASE_URL + "/api/v1/public-chatbotConfig/" + chatId
    const getConfigAndCrateChat = async () => {
      try {
        const config = await fetchUrl(configUrl);

        // Create a script element
        const script = document.createElement('script');
        script.type = 'module';
        script.src = './js/chatbot_module.js'; // Path to your module script

        // Append the script element to the document body
        document.body.appendChild(script);

        // Wait for the module script to load
        script.onload = () => {
          // Create and dispatch a custom event with the value
          const customEvent = new CustomEvent('moduleEvent', {
            detail: { config: config, color: theme_color }
          });
          window.dispatchEvent(customEvent);


          function changeBackgroundColor(element, color) {
            var style = window.getComputedStyle(element);
            element.style.backgroundColor = color;
          }
          function recolorTopBar() {
            //top bar
            el = document.querySelector("body > flowise-fullchatbot").shadowRoot.querySelector("div > div > div.flex.flex-row.items-center.w-full.h-\\[50px\\].absolute.top-0.left-0.z-10")
            changeBackgroundColor(el, theme_color)
          }

          setTimeout(recolorTopBar, 10);
          setTimeout(recolorTopBar, 50);
          setTimeout(recolorTopBar, 600);
        };
      } catch (error) {
        console.error('Error:', error);
      }
    }

    getConfigAndCrateChat();
  </script>
</body>

</html>